- Creating and running Containers in Azure
    - Create container images for solutions using Docker
    - Publish container image into Azure Container Registry
    - Deploy and run containers in Azure Container Instances.
- Docker -> Azure Container Registry(Build, store and Manage containers) -> Azure Container Instances(Run containers)
- Kubernetes
  - open-source container orchestration system for automating deployment, scaling, and management of containerized applications.
  - Originally designed by Google
  - also known as K8s
- Containers: package up binaries, libraries and other components of an application into a single deployable binary package called container image.
- Running instance of image = container - generally one image contains one application running in it. - small and portable container.
- Dockerfile: used to add set of instructions/commands used to build container image.
- Common instructions in a dockerfile:
  - copy compiled application into container image.
  - which binary to run when container is started from image.
  - copying configuration files
  - setting env. variables
- run dockerfile using: "docker build" command
- Create a container image using docker for dotnetcore application
  - [Docker_CLI](docker.sh)
- Azure container registry(ACR):
  - managed docker registry service based on open source docker registry.
  - allows to build, store, and maintain container images. for deployments.
  - ACR is key component of building a CI/CD pipeline
    - can be integrated into source control system build container images when code is committed.
  - Container Orchestrators like Kubernetes and serverless platforms like Azure Container Instance(ACI) can be configured to pull images from ACR
  - ACR tasks can be used to streamline building, testing, pushing and deploying applications in azure. Images will automatially be published on code commit.
  - Service tiers: Basic, Standard, Premium.
  - ACR Authentication and security options:
    - requires authentication for operations
      - Azure Active directory identities: Users, Service Principals
      - Service ACR admin account: disabled by default
    - Orchestrators should use headless authentication(because they are unattended) for login into ACR.
    - TODO: This didn't work: do it again?
    - To login use:
      - az acr login or docker login [using username and password - Azure AD]
      - ACR role based authentication:
        - Owner(all), Contributor(Create/delete registry + change policies + rest all), Reader(Access Resource Manager, Pull Images), AcrPush(push and pull images), AcrPull(pull images), AcrDelete(delete image data), AcrImageSigner(sign images)
  - [Creating and authenticating to ACR](acr.sh)
- deploying Azure Container Instances:
  - ACI gives a serverless PaaS to run containers in Azure without need to servers/VM.
  - For full container orchestration: use Azure Kubernetes Service.
  - Applications can be accessed via Internet or Azure virtual network for private, secure connections.
    - can be combined with ExpressRoute or VPN gateway for access from other networks outside of Azure.
  - Both windows and Linux containers can be run in ACI.
  - default: 1 core, 1 gb ram can be varied as per need.
  - Use Azure files for persistent storage.
  - ACI also support scheduling of multi-group containers that share a host machine, storage, network and life-cycle.
  - Container restart policy - tells what to do if running app inside container stops - restart always, restart on failure, restart never.
- Deploying containers in ACI from container registries via
  - Azure container registry
  - docker hub etc.
  - Public or private
- [Creating a service principal for ACI to pull from ACR and Running container from ACR to ACI](aci.sh)
